import { saveUserSettings } from "../saveAndLoad.js";

export const UI_MODE_SOIL = "soil";
export const UI_MODE_ROCK = "rock";
export const UI_BB_MODE = "UI_BB_MODE";


export const UI_GODMODE_STRENGTH = "UI_GODMODE_STRENGTH";

export const UI_NULL = "UI_NULL";
export const UI_SIZE = "UI_SIZE";
export const UI_CENTER = "UI_CENTER"

export const UI_SOIL_COMPOSITION = "UI_SOIL_COMPOSITION";
export const UI_ROCK_COMPOSITION = "UI_ROCK_COMPOSITION";
export const UI_SOIL_VIEWMODE = "UI_SOIL_VIEWMODE";
export const UI_SOIL_INITALWATER = "UI_SOIL_INITALWATER";

export const UI_SM_BB = "UI_SM_BB";
export const UI_SM_LIGHTING = "UI_SM_LIGHTING";
export const UI_SM_ORGANISM = "UI_SM_ORGANISM";
export const UI_SM_GODMODE = "UI_SM_GODMODE";
export const UI_SM_CLIMATE = "UI_SM_CLIMATE";

export const UI_LIGHTING_SUN = "UI_LIGHTING_SUN";
export const UI_LIGHTING_MOON = "UI_LIGHTING_MOON";
export const UI_LIGHTING_WATER = "UI_LIGHTING_WATER";
export const UI_LIGHTING_ROCK = "UI_LIGHTING_ROCK";
export const UI_LIGHTING_PLANT = "UI_LIGHTING_PLANT";
export const UI_LIGHTING_PLANT_TREE = "UI_LIGHTING_PLANT_TREE";
export const UI_LIGHTING_PLANT_GRASS = "UI_LIGHTING_PLANT_GRASS";
export const UI_LIGHTING_DECAY = "UI_LIGHTING_DECAY";
export const UI_LIGHTING_SURFACE = "UI_LIGHTING_SURFACE";
export const UI_LIGHTING_WATER_OPACITY = "UI_LIGHTING_WATER_OPACITY";
export const UI_LIGHTING_WATER_VALUE = "UI_LIGHTING_WATER_VALUE";
export const UI_LIGHTING_WATER_SATURATION = "UI_LIGHTING_WATER_SATURATION";
export const UI_LIGHTING_WATER_HUE = "UI_LIGHTING_WATER_HUE";


export const UI_ORGANISM_SELECT = "UI_ORGANISM_SELECT";
export const UI_ORGANISM_WHEAT = "wheat";
export const UI_ORGANISM_GRASS = "k. bluegrass";
export const UI_ORGANISM_CATTAIL = "cattail"
export const UI_ORGANISM_MUSHROOM = "mushroom"

export const UI_VIEWMODE_SELECT = "UI_VIEWMODE_SELECT";

export const UI_VIEWMODE_NORMAL = "UI_VIEWMODE_NORMAL";
export const UI_VIEWMODE_LIGHTIHNG = "UI_VIEWMODE_LIGHTIHNG";
export const UI_VIEWMODE_NITROGEN = "UI_VIEWMODE_NITROGEN";
export const UI_VIEWMODE_PHOSPHORUS = "UI_VIEWMODE_PHOSPHORUS";
export const UI_VIEWMODE_WIND = "UI_VIEWMODE_WIND";
export const UI_VIEWMODE_TEMPERATURE = "UI_VIEWMODE_TEMPERATURE";
export const UI_VIEWMODE_MOISTURE = "UI_VIEWMODE_MOISTURE";
export const UI_VIEWMODE_SURFACE = "UI_VIEWMODE_SURFACE";
export const UI_VIEWMODE_ORGANISMS = "UI_VIEWMODE_ORGANISMS";

export const UI_TOPBAR = "UI_TOPBAR";
export const UI_TOOL_MODE_LEFT = "UI_TOOL_MODE_LEFT";
export const UI_TOOL_MODE_RIGHT = "UI_TOO_MODE_RIGHT";

export const UI_GODMODE_SELECT = "UI_GODMODE_SELECT";
export const UI_GODMODE_WIND = "wind";
export const UI_GODMODE_TEMPERATURE = "temperature";
export const UI_GODMODE_MOISTURE = "moisture";
export const UI_GODMODE_KILL = "kill";
export const UI_GODMODE_FASTPLANT = "UI_GODMODE_FASTPLANT";

export const UI_CLIMATE_SELECT_MENU = "UI_CLIMATE_SELECT_MENU";
export const UI_CLIMATE_SELECT_CLOUDS = "UI_CLIMATE_SELECT_CLOUDS";
export const UI_CILMATE_SELECT_WEATHER = "UI_CLIMATE_SELECT_WEATHER";

export const UI_CLIMATE_SELECT = "UI_CLIMATE_SELECT";
export const UI_CLIMATE_MIDWEST = "UI_CLIMATE_MIDWEST";
export const UI_CLIMATE_DESERT = "UI_CLIMATE_DESERT";
export const UI_CLIMATE_FANTASY = "UI_CLIMATE_FANTASY";

export const UI_CLIMATE_WEATHER_ACTIVE = "UI_CLIMATE_WEATHER_ACTIVE";
export const UI_CLIMATE_WEATHER_SUNNY = "sunny";
export const UI_CLIMATE_WEATHER_PARTLY_CLOUDY = "partly cloudy";
export const UI_CLIMATE_WEATHER_MOSTLY_CLOUDY = "mostly cloudy";
export const UI_CLIMATE_WEATHER_FOGGY = "foggy";
export const UI_CLIMATE_WEATHER_LIGHTRAIN = "light rain";
export const UI_CLIMATE_WEATHER_HEAVYRAIN = "heavy rain";
export const UI_CLIMATE_RAINFALL_DENSITY = "UI_CLIMATE_RAINFALL_DENSITY"; 

export const UI_CLIMATE_WEATHER_DURATION = "UI_CLIMATE_WEATHER_DURATION";

export const UI_CLIMATE_WEATHER_TOOL_STRENGTH = "UI_CLIMATE_WEATHER_TOOL_STRENGTH";
export const UI_CLIMATE_WEATHER_TOOL_SELECT = "UI_CLIMATE_WEATHER_TOOL_SELECT";
export const UI_CLIMATE_WEATHER_TOOL_DRYAIR = "dry air";
export const UI_CLIMATE_WEATHER_TOOL_MATCHEDAIR = "matched air";
export const UI_CLIMATE_WEATHER_TOOL_LIGHTCLOUD = "light cloud";
export const UI_CLIMATE_WEATHER_TOOL_HEAVYCLOUD = "heavy cloud";

export const UI_TOPBAR_MAINMENU = "UI_TOPBAR_MAINMENU"; 
export const UI_TOPBAR_BLOCK = "UI_TOPBAR_BLOCK";
export const UI_TOPBAR_LIGHTING = "UI_TOPBAR_LIGHTING";
export const UI_TOPBAR_VIEWMODE = "UI_TOPBAR_VIEWMODE";
export const UI_TOPBAR_SIMULATION = "UI_TOPBAR_SIMULATION";
export const UI_TOPBAR_TIME = "UI_TOPBAR_TIME";
export const UI_TOPBAR_CLIMATE = "UI_TOPBAR_CLIMATE";

export const UI_NAME = "UI_NAME";

export const UI_SPEED = "UI_SPEED";
export const UI_SPEED_0 = "UI_SPEED_0";
export const UI_SPEED_1 = "UI_SPEED_1";
export const UI_SPEED_2 = "UI_SPEED_2";
export const UI_SPEED_3 = "UI_SPEED_3";
export const UI_SPEED_4 = "UI_SPEED_4";
export const UI_SPEED_5 = "UI_SPEED_5";
export const UI_SPEED_6 = "UI_SPEED_6";
export const UI_SPEED_7 = "UI_SPEED_7";
export const UI_SPEED_8 = "UI_SPEED_8";
export const UI_SPEED_9 = "UI_SPEED_9";

export const UI_SPEEDS = [UI_SPEED_1, UI_SPEED_2, UI_SPEED_3, UI_SPEED_4, UI_SPEED_5, UI_SPEED_6, UI_SPEED_7, UI_SPEED_8, UI_SPEED_9]
export const UI_BOOLEAN = "UI_BOOLEAN";

export const UI_LIGHTING_ENABLED = "UI_LIGHTING_ENABLED";
export const UI_LIGHTING_UPDATERATE = "UI_LIGHTING_UPDATERATE";
export const UI_LIGHTING_QUALITY = "UI_LIGHTING_QUALITY";

export const UI_SIMULATION_SIMPLESQUARE = "UI_SIMULATION_SIMPLESQUARE";
export const UI_SIMULATION_CLOUDS = "UI_SIMULATION_CLOUDS";
export const UI_SIMULATION_GENS_PER_DAY = "UI_SIMULATION_GENS_PER_DAY";
export const UI_DISPLAY_SIZEY = "UI_DISPLAY_SIZEY";

export const UI_PALETTE_ACTIVE = "UI_PALETTE_ACTIVE";
export const UI_PALETTE_SOILIDX = "UI_PALETTE_SOILIDX";
export const UI_PALETTE_ROCKIDX = "UI_PALETTE_ROCKIDX";
export const UI_PALETTE_ROCKMODE = "UI_PALETTE_ROCKMODE";
export const UI_PALETTE_COMPOSITION =  "UI_PALETTE_COMPOSITION"
export const UI_PALETTE_SHOWPICKER = "UI_PALETTE_SHOWPICKER";

export const UI_PALETTE_EYEDROPPER = "UI_PALETTE_EYEDROPPER";
export const UI_PALETTE_MIXER = "UI_PALETTE_MIXER";
export const UI_PALETTE_SIZE = "UI_PALETTE_SIZE";
export const UI_PALETTE_STRENGTH = "UI_PALETTE_STRENGTH";

export const UI_PALETTE_SELECT = "UI_PALETTE_SELECT";
export const UI_PALETTE_SOILROCK = "UI_PALETTE_SOILROCK";
export const UI_PALETTE_WATER = "UI_PALETTE_WATER";
export const UI_PALETTE_AQUIFER = "UI_PALETTE_AQUIFER";
export const UI_PALETTE_SURFACE = "UI_PALETTE_SURFACE";
export const UI_PALETTE_SURFACE_OFF = "UI_PALETTE_SURFACE_OFF";
export const UI_PALETTE_ERASE = "UI_PALETTE_ERASE";

// put default values in here
// saved directly

function getCurTimeScaleVal(v) {
    return (3.5 ** (v - 1));
}

let _GAMEDATA_DEFAULT = {
    UI_NAME: "plymouth",
    UI_PALETTE_SIZE: 6,
    UI_PALETTE_STRENGTH: 1,
    UI_PALETTE_SELECT: UI_PALETTE_SOILROCK,
    UI_PALETTE_COMPOSITION: [.40, .40, .20],
    UI_SOIL_VIEWMODE: "ðŸŽ¨",
    UI_SOIL_INITALWATER: -2,
    UI_LIGHTING_SUN: .12,
    UI_LIGHTING_MOON: -.4,
    UI_LIGHTING_WATER: 1,
    UI_LIGHTING_ROCK: 4,
    UI_LIGHTING_PLANT: 0,
    UI_LIGHTING_PLANT_GRASS: 1,
    UI_LIGHTING_PLANT_TREE: 0,
    UI_LIGHTING_DECAY: 5.2,
    UI_VIEWMODE_SELECT: UI_VIEWMODE_NORMAL,
    UI_TOPBAR: true,
    UI_SPEED: UI_SPEED_1,
    UI_CLIMATE_SELECT: UI_CLIMATE_MIDWEST,
    UI_DISPLAY_SIZEY: 100,
    UI_LIGHTING_SURFACE: 0.7,
    UI_LIGHTING_UPDATERATE: 30,
    UI_LIGHTING_QUALITY: 3,
    UI_GODMODE_STRENGTH: 0.5,
    UI_TOPBAR_BLOCK: false,
    UI_SM_GODMODE: false,
    UI_CLIMATE_RAINFALL_DENSITY: 10,
    UI_CLIMATE_WEATHER_TOOL_STRENGTH: 0.01,
    UI_PALETTE_SOILIDX: 3,
    UI_PALETTE_ROCKIDX: 0,
    UI_PALETTE_ROCKMODE: false,
    UI_SIMULATION_CLOUDS: true,
    UI_LIGHTING_ENABLED: true,
    UI_SIMULATION_GENS_PER_DAY: getCurTimeScaleVal(9),
    UI_CLIMATE_WEATHER_DURATION: 0.000694444 * 60 * 6,
    UI_CLIMATE_WEATHER_ACTIVE: UI_CLIMATE_WEATHER_SUNNY,
    UI_LIGHTING_WATER_HUE: -.1,
    UI_LIGHTING_WATER_SATURATION: .45,
    UI_LIGHTING_WATER_OPACITY: 0.33,
    UI_LIGHTING_WATER_VALUE: .5
};

export const GAMEDATA = "GAMEDATA";
export const UICONFIG = "UICONFIG";

let ROOT = {
    GAMEDATA: structuredClone(_GAMEDATA_DEFAULT),
    UICONFIG: {}
}

export function getGAMEDATA() {
    return ROOT[GAMEDATA];
}
export function setGAMEDATA(inVal) {
    ROOT[GAMEDATA] = inVal;

    Object.keys(_GAMEDATA_DEFAULT).forEach((key) => {
        if (ROOT[GAMEDATA][key] != null)
            return;
        ROOT[GAMEDATA][key] = _GAMEDATA_DEFAULT[key];
    })
}

export function getUICONFIG() {
    return ROOT[UICONFIG];
}
export function setUICONFIG(inVal) {
    ROOT[UICONFIG] = inVal;
}

let UI_FUNCTION_MAP = new Map();

let UI_SINGLE_GROUPS = [
    [UI_SM_BB, UI_PALETTE_ACTIVE, UI_SM_LIGHTING, UI_SM_ORGANISM, UI_SM_GODMODE, UI_SM_CLIMATE],
    [UI_TOPBAR_MAINMENU, UI_TOPBAR_BLOCK, UI_TOPBAR_VIEWMODE, UI_TOPBAR_LIGHTING, UI_TOPBAR_SIMULATION, UI_TOPBAR_CLIMATE],
    [UI_PALETTE_MIXER, UI_PALETTE_EYEDROPPER],
    [UI_TOPBAR_BLOCK, UI_TOPBAR_MAINMENU],
    [UI_SM_ORGANISM, UI_TOPBAR_SIMULATION],
    [UI_CLIMATE_SELECT_MENU, UI_CLIMATE_SELECT_CLOUDS, UI_CILMATE_SELECT_WEATHER],
]

let UI_AUTOCLOSE = {
    UI_TOPBAR_CLIMATE: {GAMEDATA: [UI_CLIMATE_SELECT_MENU, UI_CLIMATE_SELECT_CLOUDS, UI_CILMATE_SELECT_WEATHER]},
    UI_TOPBAR_BLOCK: {GAMEDATA: [UI_PALETTE_ACTIVE, UI_SM_ORGANISM]}
}

let queuedFunctionArr = new Array();

export function addUIFunctionMap(key, value) {
    UI_FUNCTION_MAP[key] = value;
}

export function saveGD(key, value) {
    return saveGeneral(ROOT[GAMEDATA], key, value);
}

export function saveUI(key, value) {
    return saveGeneral(ROOT[UICONFIG], key, value);
}

export function loadGD(key) {
    return ROOT[GAMEDATA][key];
}

export function saveGDMap(map) {
    _GAMEDATA = map;
}

export function loadUI(key) {
    return ROOT[UICONFIG][key];
}

export function getMapEntry(map, key) {
    return ROOT[map][key]
}
export function saveMapEntry(map, key, value) {
    saveGeneral(ROOT[map], key, value);
}

function saveGeneral(map, key, value) {
    let singleGroup = (UI_SINGLE_GROUPS.find((group) => group.indexOf(key) > -1));
    if (singleGroup != null) {
        singleGroup.filter((k) => loadGD(k)).forEach((k) => {
            ROOT[GAMEDATA][k] = false;
            if (k in UI_AUTOCLOSE) {
                UI_AUTOCLOSE[k][GAMEDATA].forEach((key2) => saveGD(key2, false));
            }
        });
    }
    if (key in UI_AUTOCLOSE)
        Object.keys(UI_AUTOCLOSE[key]).forEach((key2) => UI_AUTOCLOSE[key][key2].forEach((key3) => saveGeneral(ROOT[key2], key3, false)));

    map[key] = value;
    if (key in UI_FUNCTION_MAP) {
        queuedFunctionArr.push(UI_FUNCTION_MAP[key]);
    }
    if (!value && key in UI_AUTOCLOSE) {
        Object.keys(UI_AUTOCLOSE[key]).forEach((key2) => saveGD(key2, false));
    }
    if (map == ROOT[UICONFIG]) {
        saveUserSettings();
    }
}



export function executeFunctionQueue() {
    if (queuedFunctionArr.length != 0) {
        queuedFunctionArr.forEach((f) => f());
        queuedFunctionArr = new Array();
    }
}

export function closeEyedropperMixer() {
    if (loadGD(UI_PALETTE_MIXER) || loadGD(UI_PALETTE_EYEDROPPER)) {
        saveGD(UI_PALETTE_MIXER, false);
        saveGD(UI_PALETTE_EYEDROPPER, false);
    }
}